"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.run = void 0;
const tslib_1 = require("tslib");
const dotenv_1 = tslib_1.__importDefault(require("dotenv"));
const execa_1 = tslib_1.__importDefault(require("execa"));
const path_1 = require("path");
async function run(payload) {
    // dotenv 不会覆盖，因此优先级高的放前面
    for (const file of ['.env.local', '.env']) {
        dotenv_1.default.config({
            path: path_1.join(payload.cwd, file),
        });
    }
    try {
        await execa_1.default('node', [
            '--unhandled-rejections=strict',
            '-r',
            payload.transformer === 'swc'
                ? require.resolve('./swcRegister')
                : payload.transformer === 'esbuild'
                    ? require.resolve('./esbuildRegister')
                    : require.resolve('./babelRegister'),
            ...payload.args,
        ], {
            cwd: payload.cwd,
            env: payload.env,
            stdio: 'inherit',
        });
    }
    catch (_a) { }
}
exports.run = run;
