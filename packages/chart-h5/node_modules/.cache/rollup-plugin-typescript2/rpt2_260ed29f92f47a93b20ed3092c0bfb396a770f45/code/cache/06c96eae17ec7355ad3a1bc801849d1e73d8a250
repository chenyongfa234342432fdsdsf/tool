{"code":"import dayjs from 'dayjs';\r\nimport { createChart, CrosshairMode, LineStyle, } from 'lightweight-charts';\r\nimport React, { useEffect, useRef } from 'react';\r\nimport { ThemeEnum } from '@nbit/chart-utils';\r\nfunction SeriesChart(props) {\r\n    const lineRef = useRef(null);\r\n    const chartRef = useRef(null);\r\n    const chartLineRef = useRef();\r\n    const { priceOffset, colors } = props;\r\n    useEffect(() => {\r\n        if (chartRef.current) {\r\n            chartRef.current.setData(props.data);\r\n        }\r\n    }, [props.data]);\r\n    const colorRef = useRef(props.createChart);\r\n    useEffect(() => {\r\n        colorRef.current = props.createChart;\r\n    }, [props.createChart]);\r\n    const chartPriceLineProperty = {\r\n        crosshairMarkerVisible: false,\r\n        baseLineVisible: false,\r\n        priceLineVisible: false,\r\n        lastValueVisible: false,\r\n    };\r\n    const gridColor = props.theme === ThemeEnum.light ? 'rgba(0,0,0,0.02)' : 'rgba(255,255,255,0.02)';\r\n    const chartPropertySetting = {\r\n        layout: props.chartLayoutOptions,\r\n        localization: {\r\n            timeFormatter: item => {\r\n                return dayjs(item).format('YYYY/MM/DD HH:mm');\r\n            },\r\n            priceFormatter: item => {\r\n                return `${item.toFixed(3)}%`;\r\n            },\r\n        },\r\n        crosshair: {\r\n            mode: CrosshairMode.Normal,\r\n        },\r\n        // 时间刻度和价格刻度\r\n        timeScale: {\r\n            barSpacing: 20,\r\n            tickMarkFormatter: time => {\r\n                return dayjs(time).format('MM-DD');\r\n            },\r\n            borderColor: gridColor,\r\n            lockVisibleTimeRangeOnResize: true,\r\n        },\r\n        rightPriceScale: {\r\n            borderColor: gridColor,\r\n            // visible: true,\r\n            // alignLabels: true,\r\n            autoScale: true,\r\n        },\r\n        grid: {\r\n            vertLines: {\r\n                color: gridColor,\r\n            },\r\n            horzLines: {\r\n                color: gridColor,\r\n            },\r\n        },\r\n    };\r\n    useEffect(() => {\r\n        chartLineRef.current?.applyOptions({\r\n            ...chartPropertySetting,\r\n            layout: {\r\n                ...props.chartLayoutOptions,\r\n            },\r\n            grid: {\r\n                vertLines: {\r\n                    color: gridColor,\r\n                },\r\n                horzLines: {\r\n                    color: gridColor,\r\n                },\r\n            },\r\n            rightPriceScale: {\r\n                ...chartPropertySetting.rightPriceScale,\r\n            },\r\n        });\r\n    }, [props.chartLayoutOptions.background, props.chartLayoutOptions.textColor]);\r\n    const floatTooltip = useRef(null);\r\n    useEffect(() => {\r\n        if (floatTooltip.current) {\r\n            floatTooltip.current.style.background = props.createChart.cardBgColor;\r\n            floatTooltip.current.style.color = props.createChart.textColor01;\r\n        }\r\n    }, [props.createChart.cardBgColor, props.createChart.textColor]);\r\n    useEffect(() => {\r\n        chartLineRef.current = createChart(document.getElementById('chart'), chartPropertySetting);\r\n        // #f1ae3d\r\n        chartRef.current = chartLineRef.current.addLineSeries({\r\n            color: props?.createChart?.brandColor,\r\n            lineWidth: 1,\r\n            lineStyle: LineStyle.Solid,\r\n            ...chartPriceLineProperty,\r\n        });\r\n        chartRef.current.setData(props.data);\r\n        chartLineRef.current.timeScale().fitContent();\r\n        let toolTipWidth = 100;\r\n        let toolTipHeight = 40;\r\n        let toolTipMargin = 15;\r\n        let toolTip = document.createElement('div');\r\n        floatTooltip.current = toolTip;\r\n        toolTip.className = 'series-floating-tooltip';\r\n        toolTip.style.color = colorRef.current.textColor01;\r\n        toolTip.style.background = colorRef.current.cardBgColor03;\r\n        document.getElementById('chart')?.appendChild(toolTip);\r\n        // update tooltip\r\n        chartLineRef.current.subscribeCrosshairMove(function (param) {\r\n            if (!param.time ||\r\n                param.point.x < 0 ||\r\n                param.point.x > lineRef.current.clientWidth ||\r\n                param.point.y < 0 ||\r\n                param.point.y > lineRef.current.clientHeight) {\r\n                toolTip.style.display = 'none';\r\n                return;\r\n            }\r\n            let dateStr = dayjs(param.time).format('MM-DD HH:MM');\r\n            toolTip.style.display = 'block';\r\n            let price = param.seriesPrices.get(chartRef.current);\r\n            // eslint-disable-next-line no-useless-concat\r\n            toolTip.innerHTML = `<div>${dateStr}</div>` + `${'<div style=\"marginTop: 4px\">'}${price}%</div>`;\r\n            let y = param.point.y;\r\n            let left = param.point.x + toolTipMargin;\r\n            if (left > lineRef.current.clientWidth - toolTipWidth) {\r\n                left = param.point.x - toolTipMargin - toolTipWidth;\r\n            }\r\n            let top = 20;\r\n            toolTip.style.left = `${left}px`;\r\n            toolTip.style.top = `${top}px`;\r\n        });\r\n    }, []);\r\n    return React.createElement(\"div\", { ref: lineRef, className: \"chart\", id: \"chart\" });\r\n}\r\nSeriesChart.displayName = 'Series';\r\nexport default SeriesChart;\r\n//# sourceMappingURL=series-chart.js.map","references":["/Users/xiaoyu/Desktop/xiangmu/toolbox/node_modules/.pnpm/dayjs@1.11.3/node_modules/dayjs/index.d.ts","/Users/xiaoyu/Desktop/xiangmu/toolbox/node_modules/.pnpm/lightweight-charts@3.8.0/node_modules/lightweight-charts/dist/typings.d.ts","/Users/xiaoyu/Desktop/xiangmu/toolbox/node_modules/.pnpm/react@17.0.2/node_modules/react/index.js","/Users/xiaoyu/Desktop/xiangmu/toolbox/node_modules/.pnpm/@nbit+chart-utils@1.0.0-beta.35/node_modules/@nbit/chart-utils/lib/index.d.ts"],"map":"{\"version\":3,\"file\":\"series-chart.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/components/series/series-chart.tsx\"],\"names\":[],\"mappings\":\"AAAA,OAAO,KAAK,MAAM,OAAO,CAAA;AACzB,OAAO,EACL,WAAW,EACX,aAAa,EAIb,SAAS,GAEV,MAAM,oBAAoB,CAAA;AAC3B,OAAO,KAAK,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,OAAO,CAAA;AAChD,OAAO,EAAmB,SAAS,EAAE,MAAM,mBAAmB,CAAA;AAsB9D,SAAS,WAAW,CAAC,KAAgB;IACnC,MAAM,OAAO,GAAG,MAAM,CAAM,IAAI,CAAC,CAAA;IACjC,MAAM,QAAQ,GAAG,MAAM,CAA4B,IAAI,CAAC,CAAA;IACxD,MAAM,YAAY,GAAG,MAAM,EAAa,CAAA;IACxC,MAAM,EAAE,WAAW,EAAE,MAAM,EAAE,GAAG,KAAK,CAAA;IAErC,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,QAAQ,CAAC,OAAO,EAAE;YACpB,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,IAAkB,CAAC,CAAA;SACnD;IACH,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAA;IAEhB,MAAM,QAAQ,GAAG,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAA;IAE1C,SAAS,CAAC,GAAG,EAAE;QACb,QAAQ,CAAC,OAAO,GAAG,KAAK,CAAC,WAAW,CAAA;IACtC,CAAC,EAAE,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAA;IAEvB,MAAM,sBAAsB,GAAG;QAC7B,sBAAsB,EAAE,KAAK;QAC7B,eAAe,EAAE,KAAK;QACtB,gBAAgB,EAAE,KAAK;QACvB,gBAAgB,EAAE,KAAK;KACxB,CAAA;IAED,MAAM,SAAS,GAAG,KAAK,CAAC,KAAK,KAAK,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC,wBAAwB,CAAA;IAEjG,MAAM,oBAAoB,GAAG;QAC3B,MAAM,EAAE,KAAK,CAAC,kBAAkB;QAChC,YAAY,EAAE;YACZ,aAAa,EAAE,IAAI,CAAC,EAAE;gBACpB,OAAO,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAA;YAC/C,CAAC;YACD,cAAc,EAAE,IAAI,CAAC,EAAE;gBACrB,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAA;YAC9B,CAAC;SACF;QACD,SAAS,EAAE;YACT,IAAI,EAAE,aAAa,CAAC,MAAM;SAC3B;QACD,YAAY;QACZ,SAAS,EAAE;YACT,UAAU,EAAE,EAAE;YACd,iBAAiB,EAAE,IAAI,CAAC,EAAE;gBACxB,OAAO,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAA;YACpC,CAAC;YACD,WAAW,EAAE,SAAS;YACtB,4BAA4B,EAAE,IAAI;SACnC;QACD,eAAe,EAAE;YACf,WAAW,EAAE,SAAS;YACtB,iBAAiB;YACjB,qBAAqB;YACrB,SAAS,EAAE,IAAI;SAChB;QACD,IAAI,EAAE;YACJ,SAAS,EAAE;gBACT,KAAK,EAAE,SAAS;aACjB;YACD,SAAS,EAAE;gBACT,KAAK,EAAE,SAAS;aACjB;SACF;KACF,CAAA;IAED,SAAS,CAAC,GAAG,EAAE;QACb,YAAY,CAAC,OAAO,EAAE,YAAY,CAAC;YACjC,GAAG,oBAAoB;YACvB,MAAM,EAAE;gBACN,GAAG,KAAK,CAAC,kBAAkB;aAC5B;YACD,IAAI,EAAE;gBACJ,SAAS,EAAE;oBACT,KAAK,EAAE,SAAS;iBACjB;gBACD,SAAS,EAAE;oBACT,KAAK,EAAE,SAAS;iBACjB;aACF;YACD,eAAe,EAAE;gBACf,GAAG,oBAAoB,CAAC,eAAe;aACxC;SACF,CAAC,CAAA;IACJ,CAAC,EAAE,CAAC,KAAK,CAAC,kBAAkB,CAAC,UAAU,EAAE,KAAK,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAA;IAE7E,MAAM,YAAY,GAAG,MAAM,CAAwB,IAAI,CAAC,CAAA;IAExD,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,YAAY,CAAC,OAAO,EAAE;YACxB,YAAY,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,GAAG,KAAK,CAAC,WAAW,CAAC,WAAqB,CAAA;YAC/E,YAAY,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,WAAqB,CAAA;SAC3E;IACH,CAAC,EAAE,CAAC,KAAK,CAAC,WAAW,CAAC,WAAW,EAAE,KAAK,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC,CAAA;IAEhE,SAAS,CAAC,GAAG,EAAE;QACb,YAAY,CAAC,OAAO,GAAG,WAAW,CAAC,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAgB,EAAE,oBAAoB,CAAC,CAAA;QAEzG,UAAU;QACV,QAAQ,CAAC,OAAO,GAAG,YAAY,CAAC,OAAO,CAAC,aAAa,CAAC;YACpD,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,UAAU;YACrC,SAAS,EAAE,CAAC;YACZ,SAAS,EAAE,SAAS,CAAC,KAAK;YAC1B,GAAG,sBAAsB;SAC1B,CAAC,CAAA;QAEF,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,IAAkB,CAAC,CAAA;QAElD,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC,UAAU,EAAE,CAAA;QAE7C,IAAI,YAAY,GAAG,GAAG,CAAA;QACtB,IAAI,aAAa,GAAG,EAAE,CAAA;QACtB,IAAI,aAAa,GAAG,EAAE,CAAA;QAEtB,IAAI,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;QAC3C,YAAY,CAAC,OAAO,GAAG,OAAO,CAAA;QAC9B,OAAO,CAAC,SAAS,GAAG,yBAAyB,CAAA;QAC7C,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,OAAO,CAAC,WAAqB,CAAA;QAC5D,OAAO,CAAC,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAC,OAAO,CAAC,aAAuB,CAAA;QACnE,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE,WAAW,CAAC,OAAO,CAAC,CAAA;QAEtD,iBAAiB;QACjB,YAAY,CAAC,OAAO,CAAC,sBAAsB,CAAC,UAAU,KAAU;YAC9D,IACE,CAAC,KAAK,CAAC,IAAI;gBACX,KAAK,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC;gBACjB,KAAK,CAAC,KAAK,CAAC,CAAC,GAAG,OAAO,CAAC,OAAO,CAAC,WAAW;gBAC3C,KAAK,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC;gBACjB,KAAK,CAAC,KAAK,CAAC,CAAC,GAAG,OAAO,CAAC,OAAO,CAAC,YAAY,EAC5C;gBACA,OAAO,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAA;gBAC9B,OAAM;aACP;YAED,IAAI,OAAO,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,CAAA;YACrD,OAAO,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAA;YAC/B,IAAI,KAAK,GAAG,KAAK,CAAC,YAAY,CAAC,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAA;YACpD,6CAA6C;YAC7C,OAAO,CAAC,SAAS,GAAG,QAAQ,OAAO,QAAQ,GAAG,GAAG,8BAA8B,GAAG,KAAK,SAAS,CAAA;YAEhG,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;YAErB,IAAI,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,GAAG,aAAa,CAAA;YACxC,IAAI,IAAI,GAAG,OAAO,CAAC,OAAO,CAAC,WAAW,GAAG,YAAY,EAAE;gBACrD,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,GAAG,aAAa,GAAG,YAAY,CAAA;aACpD;YAED,IAAI,GAAG,GAAG,EAAE,CAAA;YAEZ,OAAO,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,IAAI,IAAI,CAAA;YAChC,OAAO,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,GAAG,IAAI,CAAA;QAChC,CAAC,CAAC,CAAA;IACJ,CAAC,EAAE,EAAE,CAAC,CAAA;IAEN,OAAO,6BAAK,GAAG,EAAE,OAAO,EAAE,SAAS,EAAC,OAAO,EAAC,EAAE,EAAC,OAAO,GAAO,CAAA;AAC/D,CAAC;AAED,WAAW,CAAC,WAAW,GAAG,QAAQ,CAAA;AAClC,eAAe,WAAW,CAAA\"}","dts":{"name":"/Users/xiaoyu/Desktop/xiangmu/toolbox/packages/chart-h5/node_modules/.cache/rollup-plugin-typescript2/placeholder/components/series/series-chart.d.ts","writeByteOrderMark":false,"text":"import { SeriesChartData } from '@nbit/chart-utils';\r\nexport interface PropsType {\r\n    data: Array<SeriesChartData>;\r\n    chartLayoutOptions: any;\r\n    createChart: {\r\n        brandColor: string;\r\n        upColor: string;\r\n        downColor: string;\r\n        upLightColor: string;\r\n        downLightColor: string;\r\n        bgColor?: string;\r\n        textColor?: string;\r\n        cardBgColor?: string;\r\n        textColor01?: string;\r\n        cardBgColor03?: string;\r\n    };\r\n    theme: string;\r\n    priceOffset: number;\r\n    colors: number;\r\n}\r\ndeclare function SeriesChart(props: PropsType): JSX.Element;\r\ndeclare namespace SeriesChart {\r\n    var displayName: string;\r\n}\r\nexport default SeriesChart;\r\n"}}
